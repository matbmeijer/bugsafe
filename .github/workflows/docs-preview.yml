name: Docs Preview

on:
    pull_request:
        paths:
            - "docs/**"
            - "mkdocs.yml"
            - "src/**"
            - ".github/workflows/docs-preview.yml"

jobs:
    build:
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v4

            - name: Install uv
              uses: astral-sh/setup-uv@v4
              with:
                  version: "latest"

            - name: Set up Python
              run: uv python install 3.12

            - name: Install dependencies
              run: uv sync --all-extras

            - name: Build docs
              run: uv run mkdocs build --strict

            - name: Upload docs artifact
              uses: actions/upload-artifact@v4
              with:
                  name: docs-preview
                  path: site/
                  retention-days: 7

            - name: Add build summary
              run: |
                  echo "## ðŸ“š Documentation Preview" >> $GITHUB_STEP_SUMMARY
                  echo "" >> $GITHUB_STEP_SUMMARY
                  echo "Documentation built successfully!" >> $GITHUB_STEP_SUMMARY
                  echo "" >> $GITHUB_STEP_SUMMARY
                  echo "Download the artifact to preview locally:" >> $GITHUB_STEP_SUMMARY
                  echo "1. Download \`docs-preview\` artifact from this workflow run" >> $GITHUB_STEP_SUMMARY
                  echo "2. Extract and open \`index.html\` in your browser" >> $GITHUB_STEP_SUMMARY
